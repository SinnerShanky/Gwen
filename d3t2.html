<html>
<head>
	<title>
		Test 1
	</title>
	
	<script src="d3.v3.min.js">
	</script>
</head>

<body>
	<script>
		var obj = {};
		
function upload(path) {
    d3.csv(path, function (data) {
        data.forEach(function (v) {
            var group = v.DISTRICT,
                block = v.BLOCK,
                villageObj = {};
            if (!obj.hasOwnProperty(group)) {
                obj[group] = {};
            }
            if (!obj[group].hasOwnProperty(block)) {
                obj[group][block] = [];
            }
            villageObj = v;
            delete(villageObj.DISTRICT);
            delete(villageObj.BLOCK);
            obj[group][block].push(villageObj);
        });
    });
}


function makeGraph(district, block, from, to) {

    var cnvWidth = document.innerWidth;
    var cnvHeight = document.innerHeight;

    var data = obj[district][block];
    var parsingObj = [];
    data.forEach(function (v) {
        var group = v.VILLAGE,
            villageObj = {};
        if (!parsingObj.hasOwnProperty(group)) {
            parsingObj[group] = [];
            parsingObj[group].PRE = [];
            parsingObj[group].POST = [];
        }
        villageObj = v;
        for (var i = from; i <= to; i++) {
            var preval = "JUNE_" + i,
                postval = "OCT_" + i;
            parsingObj[group].PRE[i - from] = v[preval];
            parsingObj[group].POST[i - from] = v[postval];
        }
    });

//PARSE DATA AS:  for(a in parsingObj) {console.log(parsingObj[a].PRE[0])}

	var numberVillages=0;

    var heightScale = 10;
	var widthScale = 40;

//AXIS PREPARATION
	
	var axisScale = d3.scale.linear()
					.domain([130,0])
					.range([300, 0]);
	
	var Yaxis = d3.svg.axis()
				.scale(axisScale)
				.orient("right");

//MAKE CANVAS AND ADD AXIS
				
    var canvas = d3.select("body")
        .append("svg")
        .attr("width", 1600)
        .attr("height", 900)
		.call(Yaxis)
		.append("g")
		.attr("transform","translate(50,0)");
	
//GENERATE DATA FOR BARS
	
	var i=0,
	data = [];
	
	for (village in parsingObj)
		if (village!=="")
			data.push(parsingObj[village].PRE[i]);

//GENERATE LINES	

	/*var bars = canvas.selectAll("rect")
        .data(data)
        .enter()
			.append("rect")
			.attr("width", 10)
			.attr("height", function (d) {	return 10*data[i];	})
			.attr("x", function (d, i) {	return i * 12;	})
			.attr("fill","#90c6ee");*/

	var graph = canvas.selectAll("line")
				.data(data)
				.enter()
					.append("line")
					.attr("x1",function(d,i)	{	return (widthScale * i/2);	})
					.attr("y1",function(d)	{	return heightScale*(data[i]);	})
					.attr("x2",function(d,i)	{	return (widthScale * (i+1)/2);	})
					.attr("y2",function(d)	{	return heightScale*(data[i]);	})
					.attr("stroke","#90c6ee")
					.attr("stroke-width",3);
	
	var total=to-from+1;
	var animFunc=function()
		{
			i=(i+1)%total;
			var temp=0;
			for (village in parsingObj)
				if (village!=="")
					data[temp++]=parsingObj[village].PRE[i];
			
			/*bars.transition()
				.attr("height",function(d,i) {	return 10*data[i];	})
				.attr("fill","#90c6ee");*/
				
			graph.transition()
				.attr("y1",function(d,i)	{	return heightScale*(data[i]);	})
				.attr("y2",function(d,i)	{	return heightScale*(data[i+1]);	})
				.attr("stroke","#90c6ee")
				.attr("stroke-width",1);
		}
		
//GENERATE GUIDES

	var guides = canvas;

	for(i=0;i<13;i++)
	{
		canvas.append("line")
			.attr("x1",0)
			.attr("y1",function()	{	return 30/13*i*heightScale;	})
			.attr("x2",300)
			.attr("y2",function()	{	return 30/13*i*heightScale;	})
			.attr("stroke","#d1d1d1")
			.attr("stroke-width",1);
	}	
	
	setInterval(animFunc,800);
	}
	
	</script>
</body>
</html>