<html>
<head>
	<title>
		Test 1
	</title>
	
	<script src="d3.v3.min.js">
	</script>
</head>

<body>
	<script>
		var obj = {};

function upload(path) {
    d3.csv(path, function (data) {
        data.forEach(function (v) {
            var group = v.DISTRICT,
                block = v.BLOCK,
                villageObj = {};
            if (!obj.hasOwnProperty(group)) {
                obj[group] = {};
            }
            if (!obj[group].hasOwnProperty(block)) {
                obj[group][block] = [];
            }
            villageObj = v;
            delete(villageObj.DISTRICT);
            delete(villageObj.BLOCK);
            obj[group][block].push(villageObj);
        });
    });
}


function makeGraph(district, block, from, to) {
    var cnvWidth = document.innerWidth;
    var cnvHeight = document.innerHeight;

    var data = obj[district][block];
    var parsingObj = [];
    data.forEach(function (v) {
        var group = v.VILLAGE,
            villageObj = {};
        if (!parsingObj.hasOwnProperty(group)) {
            parsingObj[group] = [];
            parsingObj[group].PRE = [];
            parsingObj[group].POST = [];
        }
        villageObj = v;
        for (var i = from; i <= to; i++) {
            var preval = "JUNE_" + i,
                postval = "OCT_" + i;
            parsingObj[group].PRE[i - from] = v[preval];
            parsingObj[group].POST[i - from] = v[postval];
        }
    });

//PARSE DATA AS:  for(a in parsingObj) {console.log(parsingObj[a].PRE[0])}
	var numberVillages=0;
	
	
	
    var colorScale = d3.scale.linear()
        .domain([1, 300])
        .range(["red", "blue"]);

    var heightScale = d3.scale.linear()
        .domain([1300, 0])
        .range([0, 300]);

    var widthScale = d3.scale.linear()
        .range([0, 1000]);

    var canvas = d3.select("body")
        .append("svg")
        .attr("width", 1600)
        .attr("height", 900);
	
	
	var i=0,
	data = [];
	
	
	for (village in parsingObj)
		if (village!=="")
			data.push(parsingObj[village].PRE[i]);
	
	
	
    var bars = canvas.selectAll("rect")
        .data(data)
        .enter()
			.append("rect")
			.attr("width", 10)
			.attr("height", function (d) {
			return heightScale(10 * d);
    })
        .attr("x", function (d, i) {
        return i * 12;
    });
	
	var total=to-from+1;
	var animFunc=function()
		{
			i=(i+1)%total;
			var temp=0;
			for (village in parsingObj)
				if (village!=="")
					data[temp++]=parsingObj[village].PRE[i];
			bars.transition()
				.attr("height",function(d,i) {	return 10*data[i];	})
				.attr("fill",function(d) {	return colorScale(d); });
		}
	setInterval(animFunc,1000);
}
	</script>
</body>
</html>